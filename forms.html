<div class="card card-dark p-3">
  <h4 style="color:#FFC400">Form Verifiche / Garanzie</h4>
  <div class="mb-2">
    <label>Tipo</label>
    <select id="formType" class="form-control"><option value="garanzia">Garanzia</option><option value="verifica">Verifica</option></select>
  </div>
  <div class="mb-2"><label>Macchina ID</label><input id="formMachine" class="form-control"></div>
  <div class="mb-2"><label>Dettagli (JSON)</label><textarea id="formData" class="form-control" rows="6">{"checks":[]}</textarea></div>
  <button class="btn btn-yellow" onclick="sendForm()">Genera PDF & Salva</button>
  <div id="formResult" class="mt-2"></div>
</div>

<script>
  const token = localStorage.getItem('manitech_token');
  function sendForm(){
    const type = document.getElementById('formType').value;
    let data;
    try { data = JSON.parse(document.getElementById('formData').value); } catch(e){ alert('JSON non valido'); return; }
    data.machineId = document.getElementById('formMachine').value;
    google.script.run.withSuccessHandler(function(res){
      document.getElementById('formResult').innerHTML = `<div class="small-muted">PDF creato: <a href="${res.pdfUrl}" target="_blank">${res.pdfUrl}</a></div>`;
    }).submitForm(token, type, data);
  }
</script>
